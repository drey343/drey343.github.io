(()=>{var t={190:t=>{function e(t,e,o){var n=function(){var i=2091639*t+2.3283064365386963e-10*o;return t=e,e=i-(o=0|i)};return n.getState=function(){return[t,e,o]},n.nextFloat=i,n.nextInt=s,n}function i(t,e){var i,s,o=this();if("number"==typeof e)i=t,s=e;else{if("number"!=typeof t)return o;i=0,s=t}return i+o*(s-i)}function s(t,e){return Math.floor(this.nextFloat(t,e))}function o(t){var i,s,o,n,r=4022871197;t="X"+(t||+new Date);for(var a=0;a<2;a++){for(var h=0;h<t.length;h++)o=.02519603282416938*(r+=t.charCodeAt(h)),o-=r=o>>>0,r=(o*=r)>>>0,r+=4294967296*(o-=r);n=2.3283064365386963e-10*(r>>>0),0===a?i=n:s=n}return e(i,s,1)}o.fromState=function(t){return e.apply(null,t)},t.exports=o}},e={};function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}(()=>{"use strict";i(190);const t=t=>{var e=t-1;return 1+e*e*e},e=(t,e)=>{for(var i=!1,s=e[0].x,o=e[0].x,n=e[0].y,r=e[0].y,a=1;a<e.length;a++){var h=e[a];s=Math.min(h.x,s),o=Math.max(h.x,o),n=Math.min(h.y,n),r=Math.max(h.y,r)}if(t.x<s||t.x>o||t.y<n||t.y>r)return!1;for(var l=0,c=e.length-1;l<e.length;c=l++)e[l].y>t.y!=e[c].y>t.y&&t.x<(e[c].x-e[l].x)*(t.y-e[l].y)/(e[c].y-e[l].y)+e[l].x&&(i=!i);return i},s=(t,e,i)=>Math.max(Math.min(t,i),e),o=({p5:t,x:e,y:i,width:s,height:o,noiseScalar:n=1,steps:r=100,start:a=0,cb:h})=>{console.log("sampling",{p5:t,x:e,y:i,width:s,height:o,noiseScalar:n,steps:r,start:a});let l=1,c=0;for(let h=0;h<o;h+=o/r)for(let o=0;o<s;o+=s/r){const s=t.noise((e+o+a)*n,(i+h+a)*n);s<l&&(l=s),s>c&&(c=s)}return{min:l,max:c}},n=(t,e,{dh:i=0,ds:o=0,db:n=0,da:r=0,h:a=null,s:h=null,b:l=null,a:c=null}={})=>t.color(null!==a?a:((t,e,i)=>{const s=t+e;return s<0?i+s:s%(i+1)})(t.hue(e),i,360),null!==h?h:s(t.saturation(e)+o,0,100),null!==l?l:s(t.brightness(e)+n,0,100),null!==c?c:s(t.alpha(e)+r,0,1)),r=(t,e,i,s)=>{const o=(t=>{const e=t.reduce(((t,{x:e,y:i})=>t?(e<t.minX&&(t.minX=e),i<t.minY&&(t.minY=i),e>t.maxX&&(t.maxX=e),i>t.maxY&&(t.maxY=i),t):{minX:e,maxX:e,minY:i,maxY:i}),null);return e.width=e.maxX-e.minX,e.height=e.maxY-e.minY,e.center={x:e.minX+e.width/2,y:e.minY+e.height/2},e.verts=[{x:e.minX,y:e.minY},{x:e.maxX,y:e.minY},{x:e.maxX,y:e.maxY},{x:e.minX,y:e.maxY}],e})(e);return e.map((({x:e,y:n})=>{const r=t.createVector(e,n);let a=t.createVector(e-o.center.x,n-o.center.y);return s?a.mult(i,s):a.mult(i),r.add(a)}))},a=({p5:t,verts:e})=>{t.beginShape(),e.forEach((({x:e,y:i})=>t.vertex(e,i))),t.endShape(t.CLOSE)},h=(t,e,i)=>t.map((t=>({x:t.x+e,y:t.y+i}))),l=(t,e)=>{const i=t.hue(e);return i<=14?"red":i<=37?"orange":i<=64?"yellow":i<=157?"green":i<=257?"blue":i<=287?"purple":i<=335?"pink":"red"},c=(t,e)=>{e.reduce(((t,{p:e})=>t+e),0)>1&&console.error("SAMPLE probabilities exceed 1");const i=t.random();return e.reduce(((t,{value:e,p:s})=>{if(void 0!==t.value)return t;const o=t.p+s;return{value:i<=o?e:void 0,p:o}}),{value:void 0,p:0}).value},d=(t,e,i,s)=>{s||(s=t.createVector(0,0));const o=Math.cos(-i),n=Math.sin(-i);return e.map((({x:e,y:i})=>{const r=o*(e-s.x)+n*(i-s.y)+s.x,a=o*(i-s.y)-n*(e-s.x)+s.y;return t.createVector(r,a)}))},p=(t,i)=>t.some((t=>e(t,i)))||i.some((i=>e(i,t)));var u,g=new Uint8Array(16);function m(){if(!u&&!(u="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(g)}const y=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,f=function(t){return"string"==typeof t&&y.test(t)};for(var x=[],S=0;S<256;++S)x.push((S+256).toString(16).substr(1));const w=function(t,e,i){var s=(t=t||{}).random||(t.rng||m)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var o=0;o<16;++o)e[i+o]=s[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(x[t[e+0]]+x[t[e+1]]+x[t[e+2]]+x[t[e+3]]+"-"+x[t[e+4]]+x[t[e+5]]+"-"+x[t[e+6]]+x[t[e+7]]+"-"+x[t[e+8]]+x[t[e+9]]+"-"+x[t[e+10]]+x[t[e+11]]+x[t[e+12]]+x[t[e+13]]+x[t[e+14]]+x[t[e+15]]).toLowerCase();if(!f(i))throw TypeError("Stringified UUID is invalid");return i}(s)},k=(t,e,i)=>t.filter((t=>t.id!==e.id&&t.position.dist(e.position)<i*e.width+(e.width+t.width/2)));class _ extends class{constructor({p5:t,x:e,y:i,color:s,width:o,height:n,velocity:r,acceleration:a,angle:h=0,angleStrategy:l="heading",aVelocity:c=0,aAcceleration:d=0,shape:p="ellipse",meta:u={},particleInit:g,mass:m=1,stroke:y,strokeWeight:f}){this.p5=t,this.x=e,this.y=i,this.position=t.createVector(e,i),this.velocity=r||t.createVector(0,0),this.acceleration=a||t.createVector(0,0),this.color=s,this.stroke=y,this.strokeWeight=f,this.width=o,this.height=n,this.angleStrategy=l,this.angle=h,this.aVelocity=c,this.aAcceleration=d,this.shape=p,this.meta=u,this.mass=m,g&&g(this)}move({velocityLimit:t}={}){this.velocity=this.velocity.add(this.acceleration),void 0!==t&&this.velocity.limit(t),this.position=this.position.add(this.velocity),this.aVelocity+=this.aAcceleration,this.angle+=this.aVelocity}scaleAcc(t){this.acceleration.mult(t)}draw({layer:t,position:e=null}={}){e=e||this.position,t=t||this.p5;const i=(()=>"heading"===this.angleStrategy?Math.atan2(this.velocity.x,this.velocity.y):this.angle)();switch(t.push(),t.rectMode("center"),t.translate(e.x,e.y),t.rotate(i),this.stroke&&this.strokeWeight?(t.stroke(this.stroke),t.strokeWeight(this.strokeWeight)):t.noStroke(),t.fill(this.color),this.shape){case"ellipse":t.ellipse(0,0,this.width,this.height||0);break;case"rect":t.rect(0,0,this.height,this.width);break;case"triangle":t.triangle(-this.width/2,this.height/2,0,-this.height/2,0,this.width/2,this.height/2)}t.pop()}adjustVelocity(t){return"function"==typeof t?t(this.velocity):this.velocity=t,this}adjustAcceleration(t){return"function"==typeof t?t(this.acceleration,this):this.acceleration=t,this}applyForce(t){this.acceleration.add(t)}applyRepeller(t){const e=t.repel(this);this.applyForce(e)}applyAttractor(t){const e=t.attract(this);this.applyForce(e)}adjustColor(t){return"function"==typeof t?t(this.color,this):this.color=t,this}adjustWidth(t){this.width=t}scaleAcceleration(t){this.acceleration.mult(t)}affect(t,e){const{G:i,polarity:s,range:o,pow:n,limit:r}={G:500,range:{min:2,max:50},...e},a=this.position.copy().sub(t.position),h=this.p5.constrain(a.magSq(),25,2500),l=s*(i*(this.mass*t.mass)/h);a.setMag(l),r&&a.limit(r),t.applyForce(a)}repel(t,e){return this.affect(t,{polarity:-1,...e})}attract(t,e){return this.affect(t,{polarity:1,...e})}}{constructor({id:t,debug:e,stationary:i=!1,settings:s,size:o,noiseScalar:n,backgroundColor:r,startT:a,...h}){super(h),this.id=t||w(),this.drawn=!1,this.debug=e,this.stationary=i,this.active=!0,this.settings=s,this.size=o,this.width=o,this.height=o,this.noiseScalar=n,this.backgroundColor=r,this.startT=a}shouldDraw(t){const e=t-this.startT;return!0===this.active&&(e+this.stopMotion-1)%this.stopMotion==0}isCollidingHistory(t,{particleSpacingScalar:e,filter:i=!0}){const s=i?k(t,this,e):t;for(let t=0;t<s.length;t++){const i=s[t];if(this.debug,i.isColliding(this,e)){if(this.debug&&this.drawn){this.p5.push(),this.p5.noStroke();const t=this.p5.random(360);this.p5.fill(this.p5.color(t,100,100,.5)),a({p5,verts:i.getVerts()}),a({p5,verts:this.getVerts()}),this.p5.pop()}return!0}}return!1}visionCone(t){const e=[{x:-t/2,y:this.width/2},{x:-t,y:-t},{x:t,y:-t},{x:t/2,y:this.width/2}];return h(d(this.p5,e,this.velocity.heading()+Math.PI/2),this.position.x,this.position.y)}}class v extends _{constructor({verts:t,...e}){super(e),this.type="poly",this.verts=t}getVerts(){return this.verts}isColliding(t,e=.5){const i=r(this.p5,this.getVerts(),e),s=r(this.p5,t.getVerts(),e);return this.debug&&(this.p5.push(),this.p5.noStroke(),this.p5.fill(this.p5.color(300,100,100,.3)),a({p5:this.p5,verts:i}),this.p5.fill(this.p5.color(200,100,100,.3)),a({p5:this.p5,verts:s}),this.p5.pop()),p(i,s)}historyMarker(){return new v({p5:this.p5,id:this.id,settings:this.settings,size:this.width,x:this.position.x,y:this.position.y,color:this.p5.color(100,100,100,.1),verts:this.getVerts()})}historyMarkerBackup(){return new b({stationary:!0,p5:this.p5,id:this.id,settings:this.settings,size:this.width/1.5,x:this.position.x,y:this.position.y,color:this.p5.color(100,100,100,.1)})}}class b extends _{constructor(t){super(t),this.type="ellipse",this.stopMotion=1,this.shouldFill=!0}historyMarker(){return new b({stationary:!0,p5:this.p5,id:this.id,settings:this.settings,size:this.width,x:this.position.x,y:this.position.y,color:"red"})}_getVerts(){this.p5.push(),this.p5.translate(0,0);const t=[];for(let e=0;e<8;e++){const i=this.p5.createVector(0,this.width/2).rotate(e*(2*Math.PI/8));t.push(i)}return this.p5.pop(),h(t,this.position.x,this.position.y)}getVerts(){return this.stationary?(this.stationary&&!this.verts&&(this.verts=this._getVerts()),this.verts):this._getVerts()}isColliding(t,e=.5){switch(t.type){case"ellipse":return this.position.dist(t.position)<(this.width/2+t.width/2)*(1+e);case"poly":{const i=r(this.p5,this.getVerts(),e),s=r(this.p5,t.getVerts(),e);return p(i,s)}}}}class M extends b{constructor(t){super(t),this.p5.random([!0,!1])?(this.stroke=this.color,this.strokeWeight=this.settings.s(.0015),this.color=this.p5.color(0,0,0,0)):(this.strokeWeight=this.settings.s(.0015),this.stroke=this.backgroundColor),this.stopMotion=2}}class C extends v{constructor({weight:t,...e}){super(e),this.stopMotion=2,this.weight=t||this.settings.s(.003)}draw(){this.p5.push(),this.p5.translate(this.position),this.p5.rotate(this.velocity.copy().rotate(-Math.PI/2).heading()),this.p5.strokeWeight(this.weight),this.p5.stroke(this.color),this.p5.line(-this.width/2,0,this.width/2,0),this.p5.pop()}bbox(){return[{x:-this.width/2,y:2*-this.weight},{x:-this.width/2,y:2*this.weight},{x:this.width/2,y:2*this.weight},{x:this.width/2,y:2*-this.weight}]}getVerts(){return h(d(this.p5,this.bbox(),this.velocity.copy().rotate(-Math.PI/2).heading()),this.position.x,this.position.y)}}class R extends v{constructor(t){super(t),this.stopMotion=7}bbox(){const t=[{x:-this.width/8,y:-this.width/2},{x:-this.width/4,y:0},{x:-this.width/8,y:this.width/2},{x:this.width/8,y:this.width/2},{x:this.width/4,y:0},{x:this.width/8,y:-this.width/2}];return r(this.p5,t,.2)}getVerts(){const t=this.velocity.copy().rotate(0).heading(),e=h(d(this.p5,this.bbox(),Math.PI/2+t),this.position.x,this.position.y);return r(this.p5,e,.3)}draw(){this.p5.push(),this.p5.translate(this.position),this.debug,this.p5.rotate(this.velocity.copy().rotate(-Math.PI/2).heading()),this.p5.noStroke(),this.p5.strokeWeight(this.width/10),this.shouldFill?(this.p5.noStroke(),this.p5.stroke(this.color),this.p5.fill(this.color)):(this.p5.noFill(),this.p5.stroke(this.color)),this.p5.beginShape(),this.p5.vertex(0,-this.width/1.8),this.p5.bezierVertex(-this.width/3,-this.width/10,-this.width/3,this.width/10,0,this.width/1.8),this.p5.bezierVertex(this.width/3,this.width/10,this.width/3,-this.width/10,0,-this.width/1.8),this.p5.endShape(this.p5.CLOSE),this.p5.strokeWeight(this.width/20),this.shouldFill?this.p5.stroke(this.backgroundColor):this.p5.stroke(this.color),this.p5.line(0,.25*-this.width,0,.25*this.width),this.p5.pop()}}class P extends b{constructor(t){super(t),this.stopMotion=5}draw(){this.p5.push(),this.p5.translate(this.position),this.p5.noStroke(),this.p5.fill(this.color);let t=[];for(let e=0;e<6;e++)t.push(this.p5.createVector(0,1).rotate(2*Math.PI/6*e).setMag(this.p5.random(this.width/3,this.width/2)));a({p5:this.p5,verts:t}),this.p5.pop()}}const F=({p5:t,baseColor:e,colorSpinRange:i})=>(t.colorMode(t.HSB),t.random()<0?t.color("black"):n(t,e,{dh:t.random(-i,i),ds:t.random(-40,40)})),V=134217729;function A(t,e,i,s,o){let n,r,a,h,l=e[0],c=s[0],d=0,p=0;c>l==c>-l?(n=l,l=e[++d]):(n=c,c=s[++p]);let u=0;if(d<t&&p<i)for(c>l==c>-l?(r=l+n,a=n-(r-l),l=e[++d]):(r=c+n,a=n-(r-c),c=s[++p]),n=r,0!==a&&(o[u++]=a);d<t&&p<i;)c>l==c>-l?(r=n+l,h=r-n,a=n-(r-h)+(l-h),l=e[++d]):(r=n+c,h=r-n,a=n-(r-h)+(c-h),c=s[++p]),n=r,0!==a&&(o[u++]=a);for(;d<t;)r=n+l,h=r-n,a=n-(r-h)+(l-h),l=e[++d],n=r,0!==a&&(o[u++]=a);for(;p<i;)r=n+c,h=r-n,a=n-(r-h)+(c-h),c=s[++p],n=r,0!==a&&(o[u++]=a);return 0===n&&0!==u||(o[u++]=n),u}function T(t){return new Float64Array(t)}const z=T(4),I=T(8),E=T(12),$=T(16),L=T(4);function N(t,e,i,s,o,n){const r=(e-n)*(i-o),a=(t-o)*(s-n),h=r-a;if(0===r||0===a||r>0!=a>0)return h;const l=Math.abs(r+a);return Math.abs(h)>=33306690738754716e-32*l?h:-function(t,e,i,s,o,n,r){let a,h,l,c,d,p,u,g,m,y,f,x,S,w,k,_,v,b;const M=t-o,C=i-o,R=e-n,P=s-n;w=M*P,p=V*M,u=p-(p-M),g=M-u,p=V*P,m=p-(p-P),y=P-m,k=g*y-(w-u*m-g*m-u*y),_=R*C,p=V*R,u=p-(p-R),g=R-u,p=V*C,m=p-(p-C),y=C-m,v=g*y-(_-u*m-g*m-u*y),f=k-v,d=k-f,z[0]=k-(f+d)+(d-v),x=w+f,d=x-w,S=w-(x-d)+(f-d),f=S-_,d=S-f,z[1]=S-(f+d)+(d-_),b=x+f,d=b-x,z[2]=x-(b-d)+(f-d),z[3]=b;let F=function(t,e){let i=e[0];for(let t=1;t<4;t++)i+=e[t];return i}(0,z),T=22204460492503146e-32*r;if(F>=T||-F>=T)return F;if(d=t-M,a=t-(M+d)+(d-o),d=i-C,l=i-(C+d)+(d-o),d=e-R,h=e-(R+d)+(d-n),d=s-P,c=s-(P+d)+(d-n),0===a&&0===h&&0===l&&0===c)return F;if(T=11093356479670487e-47*r+33306690738754706e-32*Math.abs(F),F+=M*c+P*a-(R*l+C*h),F>=T||-F>=T)return F;w=a*P,p=V*a,u=p-(p-a),g=a-u,p=V*P,m=p-(p-P),y=P-m,k=g*y-(w-u*m-g*m-u*y),_=h*C,p=V*h,u=p-(p-h),g=h-u,p=V*C,m=p-(p-C),y=C-m,v=g*y-(_-u*m-g*m-u*y),f=k-v,d=k-f,L[0]=k-(f+d)+(d-v),x=w+f,d=x-w,S=w-(x-d)+(f-d),f=S-_,d=S-f,L[1]=S-(f+d)+(d-_),b=x+f,d=b-x,L[2]=x-(b-d)+(f-d),L[3]=b;const N=A(4,z,4,L,I);w=M*c,p=V*M,u=p-(p-M),g=M-u,p=V*c,m=p-(p-c),y=c-m,k=g*y-(w-u*m-g*m-u*y),_=R*l,p=V*R,u=p-(p-R),g=R-u,p=V*l,m=p-(p-l),y=l-m,v=g*y-(_-u*m-g*m-u*y),f=k-v,d=k-f,L[0]=k-(f+d)+(d-v),x=w+f,d=x-w,S=w-(x-d)+(f-d),f=S-_,d=S-f,L[1]=S-(f+d)+(d-_),b=x+f,d=b-x,L[2]=x-(b-d)+(f-d),L[3]=b;const W=A(N,I,4,L,E);w=a*c,p=V*a,u=p-(p-a),g=a-u,p=V*c,m=p-(p-c),y=c-m,k=g*y-(w-u*m-g*m-u*y),_=h*l,p=V*h,u=p-(p-h),g=h-u,p=V*l,m=p-(p-l),y=l-m,v=g*y-(_-u*m-g*m-u*y),f=k-v,d=k-f,L[0]=k-(f+d)+(d-v),x=w+f,d=x-w,S=w-(x-d)+(f-d),f=S-_,d=S-f,L[1]=S-(f+d)+(d-_),b=x+f,d=b-x,L[2]=x-(b-d)+(f-d),L[3]=b;const G=A(W,E,4,L,$);return $[G-1]}(t,e,i,s,o,n,l)}T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(8),T(8),T(8),T(4),T(8),T(8),T(8),T(12),T(192),T(192),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(8),T(8),T(8),T(8),T(8),T(8),T(8),T(8),T(8),T(4),T(4),T(4),T(8),T(16),T(16),T(16),T(32),T(32),T(48),T(64),T(1152),T(1152),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(4),T(24),T(24),T(24),T(24),T(24),T(24),T(24),T(24),T(24),T(24),T(1152),T(1152),T(1152),T(1152),T(1152),T(2304),T(2304),T(3456),T(5760),T(8),T(8),T(8),T(16),T(24),T(48),T(48),T(96),T(192),T(384),T(384),T(384),T(768),T(96),T(96),T(96),T(1152);const W=Math.pow(2,-52),G=new Uint32Array(512);class Y{static from(t,e=K,i=D){const s=t.length,o=new Float64Array(2*s);for(let n=0;n<s;n++){const s=t[n];o[2*n]=e(s),o[2*n+1]=i(s)}return new Y(o)}constructor(t){const e=t.length>>1;if(e>0&&"number"!=typeof t[0])throw new Error("Expected coords to contain numbers.");this.coords=t;const i=Math.max(2*e-5,0);this._triangles=new Uint32Array(3*i),this._halfedges=new Int32Array(3*i),this._hashSize=Math.ceil(Math.sqrt(e)),this._hullPrev=new Uint32Array(e),this._hullNext=new Uint32Array(e),this._hullTri=new Uint32Array(e),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(e),this._dists=new Float64Array(e),this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:i,_hullTri:s,_hullHash:o}=this,n=t.length>>1;let r=1/0,a=1/0,h=-1/0,l=-1/0;for(let e=0;e<n;e++){const i=t[2*e],s=t[2*e+1];i<r&&(r=i),s<a&&(a=s),i>h&&(h=i),s>l&&(l=s),this._ids[e]=e}const c=(r+h)/2,d=(a+l)/2;let p,u,g,m=1/0;for(let e=0;e<n;e++){const i=H(c,d,t[2*e],t[2*e+1]);i<m&&(p=e,m=i)}const y=t[2*p],f=t[2*p+1];m=1/0;for(let e=0;e<n;e++){if(e===p)continue;const i=H(y,f,t[2*e],t[2*e+1]);i<m&&i>0&&(u=e,m=i)}let x=t[2*u],S=t[2*u+1],w=1/0;for(let e=0;e<n;e++){if(e===p||e===u)continue;const i=X(y,f,x,S,t[2*e],t[2*e+1]);i<w&&(g=e,w=i)}let k=t[2*g],_=t[2*g+1];if(w===1/0){for(let e=0;e<n;e++)this._dists[e]=t[2*e]-t[0]||t[2*e+1]-t[1];B(this._ids,this._dists,0,n-1);const e=new Uint32Array(n);let i=0;for(let t=0,s=-1/0;t<n;t++){const o=this._ids[t];this._dists[o]>s&&(e[i++]=o,s=this._dists[o])}return this.hull=e.subarray(0,i),this.triangles=new Uint32Array(0),void(this.halfedges=new Uint32Array(0))}if(N(y,f,x,S,k,_)<0){const t=u,e=x,i=S;u=g,x=k,S=_,g=t,k=e,_=i}const v=function(t,e,i,s,o,n){const r=i-t,a=s-e,h=o-t,l=n-e,c=r*r+a*a,d=h*h+l*l,p=.5/(r*l-a*h);return{x:t+(l*c-a*d)*p,y:e+(r*d-h*c)*p}}(y,f,x,S,k,_);this._cx=v.x,this._cy=v.y;for(let e=0;e<n;e++)this._dists[e]=H(t[2*e],t[2*e+1],v.x,v.y);B(this._ids,this._dists,0,n-1),this._hullStart=p;let b=3;i[p]=e[g]=u,i[u]=e[p]=g,i[g]=e[u]=p,s[p]=0,s[u]=1,s[g]=2,o.fill(-1),o[this._hashKey(y,f)]=p,o[this._hashKey(x,S)]=u,o[this._hashKey(k,_)]=g,this.trianglesLen=0,this._addTriangle(p,u,g,-1,-1,-1);for(let n,r,a=0;a<this._ids.length;a++){const h=this._ids[a],l=t[2*h],c=t[2*h+1];if(a>0&&Math.abs(l-n)<=W&&Math.abs(c-r)<=W)continue;if(n=l,r=c,h===p||h===u||h===g)continue;let d=0;for(let t=0,e=this._hashKey(l,c);t<this._hashSize&&(d=o[(e+t)%this._hashSize],-1===d||d===i[d]);t++);d=e[d];let m,y=d;for(;m=i[y],N(l,c,t[2*y],t[2*y+1],t[2*m],t[2*m+1])>=0;)if(y=m,y===d){y=-1;break}if(-1===y)continue;let f=this._addTriangle(y,h,i[y],-1,-1,s[y]);s[h]=this._legalize(f+2),s[y]=f,b++;let x=i[y];for(;m=i[x],N(l,c,t[2*x],t[2*x+1],t[2*m],t[2*m+1])<0;)f=this._addTriangle(x,h,m,s[h],-1,s[x]),s[h]=this._legalize(f+2),i[x]=x,b--,x=m;if(y===d)for(;m=e[y],N(l,c,t[2*m],t[2*m+1],t[2*y],t[2*y+1])<0;)f=this._addTriangle(m,h,y,-1,s[y],s[m]),this._legalize(f+2),s[m]=f,i[y]=y,b--,y=m;this._hullStart=e[h]=y,i[y]=e[x]=h,i[h]=x,o[this._hashKey(l,c)]=h,o[this._hashKey(t[2*y],t[2*y+1])]=y}this.hull=new Uint32Array(b);for(let t=0,e=this._hullStart;t<b;t++)this.hull[t]=e,e=i[e];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(function(t,e){const i=t/(Math.abs(t)+Math.abs(e));return(e>0?3-i:1+i)/4}(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:i,coords:s}=this;let o=0,n=0;for(;;){const r=i[t],a=t-t%3;if(n=a+(t+2)%3,-1===r){if(0===o)break;t=G[--o];continue}const h=r-r%3,l=a+(t+1)%3,c=h+(r+2)%3,d=e[n],p=e[t],u=e[l],g=e[c];if(U(s[2*d],s[2*d+1],s[2*p],s[2*p+1],s[2*u],s[2*u+1],s[2*g],s[2*g+1])){e[t]=g,e[r]=d;const s=i[c];if(-1===s){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,s),this._link(r,i[n]),this._link(n,c);const a=h+(r+1)%3;o<G.length&&(G[o++]=a)}else{if(0===o)break;t=G[--o]}}return n}_link(t,e){this._halfedges[t]=e,-1!==e&&(this._halfedges[e]=t)}_addTriangle(t,e,i,s,o,n){const r=this.trianglesLen;return this._triangles[r]=t,this._triangles[r+1]=e,this._triangles[r+2]=i,this._link(r,s),this._link(r+1,o),this._link(r+2,n),this.trianglesLen+=3,r}}function H(t,e,i,s){const o=t-i,n=e-s;return o*o+n*n}function U(t,e,i,s,o,n,r,a){const h=t-r,l=e-a,c=i-r,d=s-a,p=o-r,u=n-a,g=c*c+d*d,m=p*p+u*u;return h*(d*m-g*u)-l*(c*m-g*p)+(h*h+l*l)*(c*u-d*p)<0}function X(t,e,i,s,o,n){const r=i-t,a=s-e,h=o-t,l=n-e,c=r*r+a*a,d=h*h+l*l,p=.5/(r*l-a*h),u=(l*c-a*d)*p,g=(r*d-h*c)*p;return u*u+g*g}function B(t,e,i,s){if(s-i<=20)for(let o=i+1;o<=s;o++){const s=t[o],n=e[s];let r=o-1;for(;r>=i&&e[t[r]]>n;)t[r+1]=t[r--];t[r+1]=s}else{let o=i+1,n=s;j(t,i+s>>1,o),e[t[i]]>e[t[s]]&&j(t,i,s),e[t[o]]>e[t[s]]&&j(t,o,s),e[t[i]]>e[t[o]]&&j(t,i,o);const r=t[o],a=e[r];for(;;){do{o++}while(e[t[o]]<a);do{n--}while(e[t[n]]>a);if(n<o)break;j(t,o,n)}t[i+1]=t[n],t[n]=r,s-o+1>=n-i?(B(t,e,o,s),B(t,e,i,n-1)):(B(t,e,i,n-1),B(t,e,o,s))}}function j(t,e,i){const s=t[e];t[e]=t[i],t[i]=s}function K(t){return t[0]}function D(t){return t[1]}const O=1e-6;class J{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,i){const s=(t=+t)+(i=+i),o=e=+e;if(i<0)throw new Error("negative radius");null===this._x1?this._+=`M${s},${o}`:(Math.abs(this._x1-s)>O||Math.abs(this._y1-o)>O)&&(this._+="L"+s+","+o),i&&(this._+=`A${i},${i},0,1,1,${t-i},${e}A${i},${i},0,1,1,${this._x1=s},${this._y1=o}`)}rect(t,e,i,s){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+i}v${+s}h${-i}Z`}value(){return this._||null}}class q{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class Z{constructor(t,[e,i,s,o]=[0,0,960,500]){if(!((s=+s)>=(e=+e)&&(o=+o)>=(i=+i)))throw new Error("invalid bounds");this.delaunay=t,this._circumcenters=new Float64Array(2*t.points.length),this.vectors=new Float64Array(2*t.points.length),this.xmax=s,this.xmin=e,this.ymax=o,this.ymin=i,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){const{delaunay:{points:t,hull:e,triangles:i},vectors:s}=this,o=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let e,s,n=0,r=0,a=i.length;n<a;n+=3,r+=2){const a=2*i[n],h=2*i[n+1],l=2*i[n+2],c=t[a],d=t[a+1],p=t[h],u=t[h+1],g=t[l],m=t[l+1],y=p-c,f=u-d,x=g-c,S=m-d,w=2*(y*S-f*x);if(Math.abs(w)<1e-9){let o=1e9;const n=2*i[0];o*=Math.sign((t[n]-c)*S-(t[n+1]-d)*x),e=(c+g)/2-o*S,s=(d+m)/2+o*x}else{const t=1/w,i=y*y+f*f,o=x*x+S*S;e=c+(S*i-f*o)*t,s=d+(y*o-x*i)*t}o[r]=e,o[r+1]=s}let n,r,a,h=e[e.length-1],l=4*h,c=t[2*h],d=t[2*h+1];s.fill(0);for(let i=0;i<e.length;++i)h=e[i],n=l,r=c,a=d,l=4*h,c=t[2*h],d=t[2*h+1],s[n+2]=s[l]=a-d,s[n+3]=s[l+1]=c-r}render(t){const e=null==t?t=new J:void 0,{delaunay:{halfedges:i,inedges:s,hull:o},circumcenters:n,vectors:r}=this;if(o.length<=1)return null;for(let e=0,s=i.length;e<s;++e){const s=i[e];if(s<e)continue;const o=2*Math.floor(e/3),r=2*Math.floor(s/3),a=n[o],h=n[o+1],l=n[r],c=n[r+1];this._renderSegment(a,h,l,c,t)}let a,h=o[o.length-1];for(let e=0;e<o.length;++e){a=h,h=o[e];const i=2*Math.floor(s[h]/3),l=n[i],c=n[i+1],d=4*a,p=this._project(l,c,r[d+2],r[d+3]);p&&this._renderSegment(l,c,p[0],p[1],t)}return e&&e.value()}renderBounds(t){const e=null==t?t=new J:void 0;return t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),e&&e.value()}renderCell(t,e){const i=null==e?e=new J:void 0,s=this._clip(t);if(null===s||!s.length)return;e.moveTo(s[0],s[1]);let o=s.length;for(;s[0]===s[o-2]&&s[1]===s[o-1]&&o>1;)o-=2;for(let t=2;t<o;t+=2)s[t]===s[t-2]&&s[t+1]===s[t-1]||e.lineTo(s[t],s[t+1]);return e.closePath(),i&&i.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,i=t.length/2;e<i;++e){const t=this.cellPolygon(e);t&&(t.index=e,yield t)}}cellPolygon(t){const e=new q;return this.renderCell(t,e),e.value()}_renderSegment(t,e,i,s,o){let n;const r=this._regioncode(t,e),a=this._regioncode(i,s);0===r&&0===a?(o.moveTo(t,e),o.lineTo(i,s)):(n=this._clipSegment(t,e,i,s,r,a))&&(o.moveTo(n[0],n[1]),o.lineTo(n[2],n[3]))}contains(t,e,i){return(e=+e)==e&&(i=+i)==i&&this.delaunay._step(t,e,i)===t}*neighbors(t){const e=this._clip(t);if(e)for(const i of this.delaunay.neighbors(t)){const t=this._clip(i);if(t)t:for(let s=0,o=e.length;s<o;s+=2)for(let n=0,r=t.length;n<r;n+=2)if(e[s]==t[n]&&e[s+1]==t[n+1]&&e[(s+2)%o]==t[(n+r-2)%r]&&e[(s+3)%o]==t[(n+r-1)%r]){yield i;break t}}}_cell(t){const{circumcenters:e,delaunay:{inedges:i,halfedges:s,triangles:o}}=this,n=i[t];if(-1===n)return null;const r=[];let a=n;do{const i=Math.floor(a/3);if(r.push(e[2*i],e[2*i+1]),a=a%3==2?a-2:a+1,o[a]!==t)break;a=s[a]}while(a!==n&&-1!==a);return r}_clip(t){if(0===t&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];const e=this._cell(t);if(null===e)return null;const{vectors:i}=this,s=4*t;return i[s]||i[s+1]?this._clipInfinite(t,e,i[s],i[s+1],i[s+2],i[s+3]):this._clipFinite(t,e)}_clipFinite(t,e){const i=e.length;let s,o,n,r,a=null,h=e[i-2],l=e[i-1],c=this._regioncode(h,l),d=0;for(let p=0;p<i;p+=2)if(s=h,o=l,h=e[p],l=e[p+1],n=c,c=this._regioncode(h,l),0===n&&0===c)r=d,d=0,a?a.push(h,l):a=[h,l];else{let e,i,p,u,g;if(0===n){if(null===(e=this._clipSegment(s,o,h,l,n,c)))continue;[i,p,u,g]=e}else{if(null===(e=this._clipSegment(h,l,s,o,c,n)))continue;[u,g,i,p]=e,r=d,d=this._edgecode(i,p),r&&d&&this._edge(t,r,d,a,a.length),a?a.push(i,p):a=[i,p]}r=d,d=this._edgecode(u,g),r&&d&&this._edge(t,r,d,a,a.length),a?a.push(u,g):a=[u,g]}if(a)r=d,d=this._edgecode(a[0],a[1]),r&&d&&this._edge(t,r,d,a,a.length);else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return a}_clipSegment(t,e,i,s,o,n){for(;;){if(0===o&&0===n)return[t,e,i,s];if(o&n)return null;let r,a,h=o||n;8&h?(r=t+(i-t)*(this.ymax-e)/(s-e),a=this.ymax):4&h?(r=t+(i-t)*(this.ymin-e)/(s-e),a=this.ymin):2&h?(a=e+(s-e)*(this.xmax-t)/(i-t),r=this.xmax):(a=e+(s-e)*(this.xmin-t)/(i-t),r=this.xmin),o?(t=r,e=a,o=this._regioncode(t,e)):(i=r,s=a,n=this._regioncode(i,s))}}_clipInfinite(t,e,i,s,o,n){let r,a=Array.from(e);if((r=this._project(a[0],a[1],i,s))&&a.unshift(r[0],r[1]),(r=this._project(a[a.length-2],a[a.length-1],o,n))&&a.push(r[0],r[1]),a=this._clipFinite(t,a))for(let e,i=0,s=a.length,o=this._edgecode(a[s-2],a[s-1]);i<s;i+=2)e=o,o=this._edgecode(a[i],a[i+1]),e&&o&&(i=this._edge(t,e,o,a,i),s=a.length);else this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(t,e,i,s,o){for(;e!==i;){let i,n;switch(e){case 5:e=4;continue;case 4:e=6,i=this.xmax,n=this.ymin;break;case 6:e=2;continue;case 2:e=10,i=this.xmax,n=this.ymax;break;case 10:e=8;continue;case 8:e=9,i=this.xmin,n=this.ymax;break;case 9:e=1;continue;case 1:e=5,i=this.xmin,n=this.ymin}s[o]===i&&s[o+1]===n||!this.contains(t,i,n)||(s.splice(o,0,i,n),o+=2)}if(s.length>4)for(let t=0;t<s.length;t+=2){const e=(t+2)%s.length,i=(t+4)%s.length;(s[t]===s[e]&&s[e]===s[i]||s[t+1]===s[e+1]&&s[e+1]===s[i+1])&&(s.splice(e,2),t-=2)}return o}_project(t,e,i,s){let o,n,r,a=1/0;if(s<0){if(e<=this.ymin)return null;(o=(this.ymin-e)/s)<a&&(r=this.ymin,n=t+(a=o)*i)}else if(s>0){if(e>=this.ymax)return null;(o=(this.ymax-e)/s)<a&&(r=this.ymax,n=t+(a=o)*i)}if(i>0){if(t>=this.xmax)return null;(o=(this.xmax-t)/i)<a&&(n=this.xmax,r=e+(a=o)*s)}else if(i<0){if(t<=this.xmin)return null;(o=(this.xmin-t)/i)<a&&(n=this.xmin,r=e+(a=o)*s)}return[n,r]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const Q=2*Math.PI,tt=Math.pow;function et(t){return t[0]}function it(t){return t[1]}function st(t,e,i){return[t+Math.sin(t+e)*i,e+Math.cos(t-e)*i]}class ot{static from(t,e=et,i=it,s){return new ot("length"in t?function(t,e,i,s){const o=t.length,n=new Float64Array(2*o);for(let r=0;r<o;++r){const o=t[r];n[2*r]=e.call(s,o,r,t),n[2*r+1]=i.call(s,o,r,t)}return n}(t,e,i,s):Float64Array.from(function*(t,e,i,s){let o=0;for(const n of t)yield e.call(s,n,o,t),yield i.call(s,n,o,t),++o}(t,e,i,s)))}constructor(t){this._delaunator=new Y(t),this.inedges=new Int32Array(t.length/2),this._hullIndex=new Int32Array(t.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&function(t){const{triangles:e,coords:i}=t;for(let t=0;t<e.length;t+=3){const s=2*e[t],o=2*e[t+1],n=2*e[t+2];if((i[n]-i[s])*(i[o+1]-i[s+1])-(i[o]-i[s])*(i[n+1]-i[s+1])>1e-10)return!1}return!0}(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,i)=>e[2*t]-e[2*i]||e[2*t+1]-e[2*i+1]));const t=this.collinear[0],i=this.collinear[this.collinear.length-1],s=[e[2*t],e[2*t+1],e[2*i],e[2*i+1]],o=1e-8*Math.hypot(s[3]-s[1],s[2]-s[0]);for(let t=0,i=e.length/2;t<i;++t){const i=st(e[2*t],e[2*t+1],o);e[2*t]=i[0],e[2*t+1]=i[1]}this._delaunator=new Y(e)}else delete this.collinear;const i=this.halfedges=this._delaunator.halfedges,s=this.hull=this._delaunator.hull,o=this.triangles=this._delaunator.triangles,n=this.inedges.fill(-1),r=this._hullIndex.fill(-1);for(let t=0,e=i.length;t<e;++t){const e=o[t%3==2?t-2:t+1];-1!==i[t]&&-1!==n[e]||(n[e]=t)}for(let t=0,e=s.length;t<e;++t)r[s[t]]=t;s.length<=2&&s.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=s[0],n[s[0]]=1,2===s.length&&(n[s[1]]=0,this.triangles[1]=s[1],this.triangles[2]=s[1]))}voronoi(t){return new Z(this,t)}*neighbors(t){const{inedges:e,hull:i,_hullIndex:s,halfedges:o,triangles:n,collinear:r}=this;if(r){const e=r.indexOf(t);return e>0&&(yield r[e-1]),void(e<r.length-1&&(yield r[e+1]))}const a=e[t];if(-1===a)return;let h=a,l=-1;do{if(yield l=n[h],h=h%3==2?h-2:h+1,n[h]!==t)return;if(h=o[h],-1===h){const e=i[(s[t]+1)%i.length];return void(e!==l&&(yield e))}}while(h!==a)}find(t,e,i=0){if((t=+t)!=t||(e=+e)!=e)return-1;const s=i;let o;for(;(o=this._step(i,t,e))>=0&&o!==i&&o!==s;)i=o;return o}_step(t,e,i){const{inedges:s,hull:o,_hullIndex:n,halfedges:r,triangles:a,points:h}=this;if(-1===s[t]||!h.length)return(t+1)%(h.length>>1);let l=t,c=tt(e-h[2*t],2)+tt(i-h[2*t+1],2);const d=s[t];let p=d;do{let s=a[p];const d=tt(e-h[2*s],2)+tt(i-h[2*s+1],2);if(d<c&&(c=d,l=s),p=p%3==2?p-2:p+1,a[p]!==t)break;if(p=r[p],-1===p){if(p=o[(n[t]+1)%o.length],p!==s&&tt(e-h[2*p],2)+tt(i-h[2*p+1],2)<c)return p;break}}while(p!==d);return l}render(t){const e=null==t?t=new J:void 0,{points:i,halfedges:s,triangles:o}=this;for(let e=0,n=s.length;e<n;++e){const n=s[e];if(n<e)continue;const r=2*o[e],a=2*o[n];t.moveTo(i[r],i[r+1]),t.lineTo(i[a],i[a+1])}return this.renderHull(t),e&&e.value()}renderPoints(t,e){void 0!==e||t&&"function"==typeof t.moveTo||(e=t,t=null),e=null==e?2:+e;const i=null==t?t=new J:void 0,{points:s}=this;for(let i=0,o=s.length;i<o;i+=2){const o=s[i],n=s[i+1];t.moveTo(o+e,n),t.arc(o,n,e,0,Q)}return i&&i.value()}renderHull(t){const e=null==t?t=new J:void 0,{hull:i,points:s}=this,o=2*i[0],n=i.length;t.moveTo(s[o],s[o+1]);for(let e=1;e<n;++e){const o=2*i[e];t.lineTo(s[o],s[o+1])}return t.closePath(),e&&e.value()}hullPolygon(){const t=new q;return this.renderHull(t),t.value()}renderTriangle(t,e){const i=null==e?e=new J:void 0,{points:s,triangles:o}=this,n=2*o[t*=3],r=2*o[t+1],a=2*o[t+2];return e.moveTo(s[n],s[n+1]),e.lineTo(s[r],s[r+1]),e.lineTo(s[a],s[a+1]),e.closePath(),i&&i.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,i=t.length/3;e<i;++e)yield this.trianglePolygon(e)}trianglePolygon(t){const e=new q;return this.renderTriangle(t,e),e.value()}}const nt=({p5:t,settings:i,obstacles:s,color:o,colorSpinRange:r,x:l,y:c,size:d,fill:p})=>{t.push(),t.strokeJoin(t.BEVEL),t.translate(l,c);let u=[],g=[],m=0,y=t.map(i.p(d),0,.3,0,i.s(.002));for(let e=0;e<6;e++){const i=t.random(d/4,d/2);u.push(t.createVector(0,1).rotate(2*Math.PI/6*e).setMag(i)),i>m&&(m=i)}for(let i=0;i<Math.floor(t.random(20,100));i++){const i=t.createVector(t.random(-.5,.5)*d,t.random(-.5,.5)*d);e(i,u)&&g.push(i)}const f=ot.from([...u.map((({x:t,y:e})=>[t,e])),...g.map((({x:t,y:e})=>[t,e]))]),x=Array.from(f.trianglePolygons());o=F({p5:t,baseColor:o,colorSpinRange:r}),x.forEach((e=>{p?(t.noStroke(),t.fill(n(t,o,{dh:t.random(-20,20),a:t.random(.7,1)}))):(t.noFill(),t.stroke(o),t.strokeWeight(y)),a({p5:t,verts:e.map((([t,e])=>({x:t,y:e})))})})),s.push(new v({p5:t,settings:i,x:l,y:c,id:w(),size:2*m*.8,type:"verts",verts:h(u,l,c)})),t.pop()},rt=({p5:t,settings:e,obstacles:i,baseColor:s,size:o,count:n,colorSpinRange:r})=>{const a=t.createVector(e.s(t.random()),e.s(t.random()));for(let h=0;h<n;h++){const l=0===h?a:a.copy().add(t.createVector(e.s(t.random(.1),0)).rotate(t.random(2*Math.PI)));nt({p5:t,obstacles:i,x:l.x,y:l.y,settings:e,size:o*((n-h)/n),color:s,colorSpinRange:r,fill:t.random([!0,!1])})}},at=({p5:t,settings:e,backgroundColor:i})=>{t.push(),t.noFill(),t.strokeWeight(e.s(.1)),t.stroke(i),t.rectMode(t.CORNER),t.rect(0,0,e.s(1),e.sy(1)),t.pop()};class ht{constructor({p5:t,settings:e,x:i=0,y:s=0,height:n,width:r,detail:a,scalar:h,steps:l=500}){this.p5=t,this.settings=e,this.start=t.random(2e5),this.p5.noiseSeed(this.start),this.x=i,this.y=s,this.width=r||e.s(1),this.height=n||e.sy(1),this.scalar=h,a&&this.p5.noiseDetail(a);const c=o({p5:this.p5,x:0,y:0,height:this.height,width:this.width,steps:l,noiseScalar:this.scalar,start:this.start});this.min=c.min,this.max=c.max,this.range=this.max-this.min,this.strata=[],this.addStrata({name:"all",startP:0,sizeP:1})}mapRange(t){return this.p5.map(t,0,1,0,this.range)}mapNoise(t){return this.p5.map(t,0,1,this.min,this.max)}unmapNoise(t){return this.p5.map(t,this.min,this.max,0,1)}addStrata({name:t,startP:e,sizeP:i}){const s={name:t,start:this.mapNoise(e),end:this.mapNoise(e+i)};return this.strata.forEach(((t,e,i)=>{t.end<s.start||t.start>s.end?console.log("no effect"):t.start<s.start&&t.end>s.end?(console.log("splitting strata"),i.splice(e,1),i.push({name:t.name,start:t.start,end:s.start}),i.push({name:t.name,start:s.end,end:t.end})):t.start<s.start&&t.end<s.end?(console.log("truncating end"),t.end=s.start):t.start>s.start&&t.end>s.end&&(console.log("truncating end"),t.start=s.end)})),this.strata.push(s),this}getStrata({n:t,gapP:e=0}){const i=this.mapRange(e);return this.strata.find((e=>t>e.start+i/2&&t<e.end-i/2))}noise(t,e,i){"object"==typeof e&&(i=e,e=null);const{scalar:s,start:o}=i||{},n=s||this.scalar,r=o||this.start,a=this.p5.noise((t+r)*n,e?(e+r)*n:void 0);return i.strata?{noise:a,strata:this.getStrata({n:a,gapP:i?.gapP})}:a}}const lt=({p5:t,settings:e,noiseScalar:i,noiseField:s,noiseFieldStart:o=0})=>{let n,r=0;for(;!n&&r<100;){r++,n=t.createVector(e.s(t.random()),e.sy(t.random()));const a=t.noise((n.x+o)*i,(n.y+o)*i),h=t.map(a,s.min,s.max,0,1);Math.pow(t.random(),4)<h&&(n=void 0)}return n},ct=({p5:t,settings:e,particles:i,headingModifierScalar:s,headingModifierPeriod:o,noiseFieldModifierScalar:r,noiseFieldModifierPeriod:h,sizeSinPeriod:l,sizeSinScalar:c,motionSinPeriod:d,motionSinScalar:p,spinSlinkyStroke:u,history:g,particleSpacingScalar:m,layoutNoiseField:y,t:f,particleSpinRate:x,headingRotation:S,headingTransform:w,noiseFieldModifier:_,obstacles:v,debug:b})=>{i=i.filter((t=>t.active)),s&&f%o==0&&i.forEach((t=>{t.headingModifier?t.headingModifier=0:t.headingModifier=Math.PI*s})),r&&f%h==0&&(_=!_);const M=t.map(f%l/l,0,1,0,2*Math.PI),R=t.map(f%d/d,0,1,0,2*Math.PI),P=Math.sin(M),F=Math.sin(R);return i.filter((t=>t.active)).forEach(((s,o)=>{s.velocity.setMag(.15*s.width),s.color=n(t,s.color,{dh:x}),u&&s.stroke&&!s.shouldFill&&(s.stroke=n(t,s.stroke,{dh:x}));let r=(({p5:t,settings:e,p:i,initialRotation:s,transformFn:o,noiseFieldModifier:n})=>{const r=n?(1-e.py(i.position.y))*i.noiseScalar:e.py(i.position.y)*i.noiseScalar,a=(({p5:t,x:e,y:i})=>{const s=t.noise(e,i+2e4),o=t.noise(e+4e4,i+6e4),n=t.map(s,0,1,1,2),r=t.map(o,0,1,1,2);return t.noise(e*n,i*r)})({p5:t,x:e.p(i.position.x)*i.noiseScalar,y:r});let h=t.map(a,0,1,-2*Math.PI,2*Math.PI)+s;return i.headingModifier&&(h+=i.headingModifier),h})({p5:t,settings:e,p:s,initialRotation:S,transformFn:w,noiseFieldModifier:_});if(s.velocity.setHeading(r),s.position.x<e.s(0)||s.position.x>e.s(1)||s.position.y<e.sy(0)||s.position.y>e.sy(1))return void(s.active=!1);if(p&&s.velocity.rotate(t.map(F,-1,1,.5*-Math.PI*p,.5*Math.PI*p)),c){const e=(1-t.map(P,-1,1,.2,1)*c)*s.size;s.width=e,s.height=e}s.move();const h=k(g,s,m);if(console.log(h.length),[...v,...h].forEach((e=>{if(b&&(t.push(),t.noStroke(),t.fill("black"),f%20==0&&t.text(e.id,e.position.x,e.position.y),t.pop()),e.isColliding(s,m)){if(b&&s.drawn){t.push(),t.noStroke();const i=100;t.fill(t.color(i,100,100,.5)),a({p5:t,verts:e.getVerts()}),a({p5:t,verts:s.getVerts()}),t.pop()}s.active=!1}})),s.active&&s.shouldDraw(f)){b&&(t.push(),t.fill(0,100,100,.2),t.noStroke(),a({p5:t,verts:s.getVerts()}),t.pop());const{strata:n}=y.noise(e.p(s.position.x),e.py(s.position.y),{strata:!0,gapP:.04});switch(n?.name){case"dots":(s=new C({p5:t,settings:e,color:s.color,x:s.position.x,y:s.position.y,size:s.size/2,velocity:s.velocity.copy(),weight:e.s(.01)})).draw(),g.push(s.historyMarker()),s.active=!1;break;case"all":s.draw(),s.drawn=!0,g.push(s.historyMarker());break;default:i.splice(o,1)}}})),i};let dt,pt;document.getElementsByClassName("loading")[0].style.display="none";const ut=({p5:t,settings:e,baseColor:i,backgroundColor:s})=>{t.noLoop(),window.done=!0,fxpreview(),window.addEventListener("keypress",(e=>{"s"===e.key&&t.save("macondo.png")}))},gt=({p5:t,settings:e,baseColor:i,particleSize:s,noiseScalar:o,noiseScalarMin:n,noiseScalarMax:r,drawingStyle:a,backgroundColor:h,type:l,colorSpinRange:c,motionSinPeriod:d,t:p})=>{const u=new l({p5:t,startT:p,x:e.s(t.random()),y:e.sy(t.random()),settings:e,size:e.s(s),noiseScalar:o,velocity:t.createVector(e.s(.02),0),backgroundColor:h,color:F({p5:t,baseColor:i,colorSpinRange:c}),motionSinPeriod:Math.floor(d*t.random(.5,1.5))});return u.drawingStyle=a,u.shouldFill=t.random([!0,!1]),u.noiseScalar=o||t.random(n,r),u},mt=({p5:t,settings:e,backgroundColor:i})=>{const s=.001,n=o({p5:t,x:0,y:0,width:e.s(1),height:e.sy(1),steps:500,noiseScalar:s});o({p5:t,x:0,y:0,width:e.s(1),height:e.sy(1),steps:500,noiseScalar:s,noiseFieldStart:4e4}),console.log(n.min,n.max);for(let o=0;o<2e4;o++){t.stroke(i),t.strokeWeight(e.s(.001));const o=lt({p5:t,settings:e,noiseScalar:s,noiseField:n});if(!o)continue;const r=t.createVector(0,e.s(-.002));r.rotate(t.random(2*Math.PI)),r.add(o),t.line(o.x,o.y,r.x,r.y)}for(let i=0;i<0;i++){t.stroke(baseColor),t.strokeWeight(e.s(.001));const i=lt({p5:t,settings:e,noiseScalar:s,noiseField:n,noiseFieldStart:4e4});if(!i)continue;const o=t.createVector(0,e.s(-.001));o.rotate(t.random(2*Math.PI)),o.add(i),t.line(i.x,i.y,o.x,o.y)}at({p5:t,settings:e,backgroundColor:i})};document.addEventListener("DOMContentLoaded",(()=>{const e=~~(123456789*fxrand()),i=document.getElementById("container");new p5((e=>i=>{const r=new URLSearchParams(window.location.search);r.get("seed")&&(e=r.get("seed")),i.colorMode(i.HSB),console.log({seed:e}),i.randomSeed(e),i.noiseSeed(e);let a,h,d=0,p=[],u=Math.min(i.randomGaussian(.045,.005),.05),g=s(i.randomGaussian(.01,.003),.007,u),m=i.random()<.5?Math.max(.2,i.randomGaussian(.8,.25)):Math.max(.2,i.randomGaussian(1.2,.4)),y=0,f=-.5,x=t,S=i.random(.3,.8),w=Math.floor(i.random(5,100)),k=i.random([0,i.random(.3)]),_=i.map(i.random(),0,1,-Math.PI,Math.PI),v=t=>i.map(t,0,2*Math.PI,-1,1),F=s(i.random()>.5?i.randomGaussian(80,20):i.randomGaussian(100,60),20,300);F=i.randomGaussian(70,20);let V,A,T,z,I,E,$,L,N,W=i.randomGaussian(.5,.1),G=i.random(60,100),Y=!1,H=!1,U=[];const X=()=>[i.random([{name:"ellipse",className:b},!1]),i.random([{name:"slinky",className:M},!1]),i.random([{name:"ladder",className:C},!1]),i.random([{name:"rock",className:P},!1]),i.random([{name:"leaf",className:R},!1])].filter(Boolean);let B=X();for(;!B.length;)B=X();let j=()=>i.random(B);i.colorMode(i.HSB);let K=i.color(i.random(360),60,100),D=!1,O=i.color(i.random(360),G,90);const J=(({p5:t})=>[{backgroundColor:t.color(217.08448545075953,60,100),baseColor:t.color(198.12939573079348,65.01289452426134,90),colorSpinRange:68,particleSpinRate:.53},{backgroundColor:t.color([228.11786647886038,60,100]),baseColor:t.color([136.68519529514015,89.40876549109817,90]),colorSpinRange:112,particleSpinRate:.46},{backgroundColor:t.color([239.39280959777534,60,100]),baseColor:t.color([41.380207221955054,61.56268280930818,90]),colorSpinRange:96,particleSpinRate:.67},{backgroundColor:t.color([253.56879553757608,60,100]),baseColor:t.color([124.37665404751897,68.43582660891116,90]),colorSpinRange:72,particleSpinRate:.48},{backgroundColor:t.color([223.9149265922606,60,100]),baseColor:t.color([118.1704527977854,76.42378453165293,90]),colorSpinRange:113,particleSpinRate:.45},{backgroundColor:t.color([338.96381565369666,60,100]),baseColor:t.color([230.2354396507144,77.65174048952758,90]),colorSpinRange:47,particleSpinRate:.41},{backgroundColor:t.color([62.46440118178725,60,100]),baseColor:t.color([242.3615846503526,80.00895038247108,90]),colorSpinRange:50,particleSpinRate:.3},{backgroundColor:t.color([.6100075040012642,60,100]),baseColor:t.color([257.72506792098284,94.90709180943668,90]),colorSpinRange:68,particleSpinRate:.58},{backgroundColor:t.color([26.02632734924555,60,100]),baseColor:t.color([237.51547317020595,72.50829501077533,90]),colorSpinRange:33,particleSpinRate:.37},{backgroundColor:t.color([206.80731662549078,60,80]),baseColor:t.color([73.69051527231932,73.59010535292326,90]),colorSpinRange:61,particleSpinRate:.56},{backgroundColor:t.color([5.615113964304331,60,100]),baseColor:t.color([262.55590388551354,90.35117694176733,90]),colorSpinRange:75,particleSpinRate:.57},{backgroundColor:t.color([83.49566861987114,60,100]),baseColor:t.color([192.7939612325281,99.85974783077836,90]),colorSpinRange:40,particleSpinRate:.5}])({p5:i}),q=i.random();q<.5?(K=i.color("#222"),D=!0,O=i.color(i.random(360),G,90)):q<.9?(K=i.color(i.random(360),60,100),D=!1,O="black"):({backgroundColor:K,baseColor:O,colorSpinRange:F,particleSpinRate:W}=i.random(J)),console.log([i.hue(K),i.saturation(K),i.brightness(K)]),console.log([i.hue(O),i.saturation(O),i.brightness(O)]),console.log({backgroundColor:K,baseColor:O,colorSpinRange:F,particleSpinRate:W,headingModifierScalar:k,headingModifierPeriod:w,particleCount:2,noiseScalar:m,particleSpacingScalar:f,colorSpinRange:F,particleSpinRate:W,particleSizeMin:g,particleSizeMax:u}),i.setup=()=>{i.noStroke(),i.ellipseMode(i.CENTER),i.rectMode(i.CENTER),pt=(({canvasWidth:t,canvasHeight:e,p5:i,publishAttributes:s=!1})=>{const o={s:e=>parseFloat((t*e).toFixed(5)),sy:t=>parseFloat((e*t).toFixed(5)),p:e=>parseFloat((e/t).toFixed(5)),py:t=>parseFloat((t/e).toFixed(5)),canvas:{width:t,height:e},field:[{x:0,y:0},{x:t,y:0},{x:t,y:e},{x:0,y:e}],headings:{noiseRangeMin:.002,noiseRangeMax:.006,noiseScalar:15,jitter:i.random(.1,.3),rotation:i.random()},pen:{type:c(i,[{value:"marker",p:.3},{value:"hatch",p:.3},{value:"sketch",p:.4}])},mountain:{layers:Math.max(1,Math.floor(i.randomGaussian(2,2)))},sky:{block:{alpha:1,scalar:i.random(.3,3.5)},cutSteps:Math.floor(Math.max(i.randomGaussian(4,4),1)),cutStepHeight:i.random(.015,.03),cutConnector:c(i,[{value:!0,p:.7},{value:!1,p:.3}]),cutConnectorRange:Math.max(50,i.randomGaussian(50,50)),cutConnectorModifierMatch:i.random([!0,!1]),cutStepYScalar:!0,rotationScalar:i.random(),noiseScalar:i.random(10),hueJitter:i.random(60),brightnessJitter:i.random(60),strataCount:Math.floor(i.random(10)),strataAttribute:i.random(["hue","brightness","saturation"]),strataJitter:i.random(10,30)*i.random([-1,1]),color:i.color(i.random(360),i.random(20,80),i.random(20,80),.2),fadeWidth:i.random([!0,!1]),xSteps:200}};o.penTypes=Array.from(Array(o.mountain.layers)).map((()=>i.random(["hatch","sketch","marker"]))),o.headings.scalarStrategy=c(i,[{value:"high",p:.25},{value:"low",p:.1},{value:"medium",p:.65}]),o.headings.scalar=(()=>{switch(o.headings.scalarStrategy){case"low":return 100;case"medium":return 300;case"high":return 2e3}})(),o.headings.noiseMax=i.random(o.headings.noiseRangeMin,o.headings.noiseRangeMax),o.sky.cutStepsEasing=c(i,[{value:"none",p:o.sky.cutStepYScalar?1:.4},{value:"in",p:o.sky.cutStepYScalar?0:.3},{value:"out",p:o.sky.cutStepYScalar?0:.3}]),o.margin=o.s(i.random(.03,.05)),o.sky.frames=i.map(o.sky.block.scalar,.3,3.5,60,30),o.block={min:.5,max:2.5},o.theme=c(i,[{value:"light",p:1.2},{value:"gradient",p:.2},{value:"sky",p:.6}]),o.headings.rotation=i.random(1),o.background={color:(()=>{switch(o.theme){case"light":case"sky":return i.color(47,i.random(20,20),i.random(50,90));default:return i.color(0,0,0,0)}})()},o.mountain.color=i.color(0,0,0,1),o.noiseField=(()=>{let t,e;return o.theme,t=i.color(0,0,0,.15),e=i.color(0,0,100,.1),{dark:{color:t},light:{color:e}}})(),o.frame={layers:Math.floor(i.random(1,6)),color:i.color(0,0,0,1),type:c(i,[{value:"dot",p:.25},{value:"drawn",p:.25},{value:"hatch",p:.25},{value:"flow",p:.25}])},o.gradientColor=i.color(i.random(360),i.random(20,80),i.random(70,90)),o.sky.cutConnectorColor=i.random([o.background.color,i.color("black")].filter(Boolean)),o.sky.cutConnectorColor=n(i,o.sky.cutConnectorColor,{a:i.random(.5,1)}),o.sky.cutConnectorStrokeWeight=o.s(i.random(.001,.002)),o.mountain.layers>4&&(o.sky.cutSteps=Math.min(o.sky.cutSteps,3));const r=t=>{return e=o.penTypes.filter((e=>e===t)).length/o.penTypes.length,0===e?"none":e<.3?"low":e<.7?"medium":e<1?"high":"all";var e};return s&&(window.$fxhashFeatures={background:["light","sky"].includes(o.theme)?"paper":o.theme,"hatch pen":r("hatch"),"sketch pen":r("sketch"),"marker pen":r("marker"),"mountain ranges":o.mountain.layers,"pen curve scalar":o.headings.scalarStrategy,"pen responsiveness":o.headings.rotation<.3?"low":o.headings.rotation<.7?"medium":"high","pen noise":(()=>{const t=i.map(o.headings.noiseMax,o.headings.noiseRangeMin,o.headings.noiseRangeMax,0,1);return t<.3?"low":t<.7?"medium":"high"})(),scene:"sky"===o.theme?"sky":o.frame.type,"scene color":"sky"===o.theme?l(i,o.sky.color):"black","sky strata count":"sky"===o.theme?o.sky.strataCount:"-","sky strata attribute":"sky"===o.theme&&o.sky.strataCount>0?o.sky.strataAttribute:"-","sky fade":"sky"===o.theme?o.sky.fadeWidth?"size":"alpha":"-","sky cuts":o.sky.cutSteps,"sky cuts easing":o.sky.cutSteps>0?o.sky.cutStepsEasing:"-","sky cut connectors":"sky"===o.theme?o.sky.cutConnector:"-","sky cut connector range":"sky"===o.theme&&o.sky.cutConnector?o.sky.cutConnectorRange<100?"low":o.sky.cutConnectorRange<200?"medium":"high":"-","sky cut connector alignment":"sky"===o.theme?o.sky.cutConnector&&o.sky.cutConnectorModifierMatch:"-"}),o})({p5:i,canvasWidth:1e3,canvasHeight:1250,area:[{x:0,y:0}],publishAttributes:!0}),console.log(window.$fxhashFeatures);const t=(()=>{i.push(),i.colorMode(i.RGB);const t=i.red(K),e=i.green(K),s=i.blue(K);return i.pop(),{r:t,g:e,b:s}})(),e=`rgba(${t.r},${t.g},${t.b},1)`;console.log(e),dt=i.createCanvas(pt.canvas.width,pt.canvas.height),dt.parent("fullscreen"),document.getElementById("fullscreen").style.backgroundColor=e,a=()=>{i.background(K)},window.addEventListener("keypress",(t=>{" "===t.key&&(i.isLooping()?i.noLoop():i.loop())})),$=i.createGraphics(pt.s(1),pt.sy(1)),E=i.createGraphics(pt.s(1),pt.sy(1)),V=o({p5:i,x:0,y:0,width:pt.s(m),height:pt.s(m),steps:500}),A=i.random(V.min,(V.max-V.min)/2),T=.2*(V.max-V.min),z=A+T,console.log({noiseFieldEmptyStart:A,noiseFieldEmptySize:T}),L=new ht({p5:i,settings:pt,width:1,height:1,scalar:1,steps:5e3}),L.addStrata({name:"dots",startP:i.random(0,.8),sizeP:.1}),L.addStrata({name:"dots",startP:i.random(0,.8),sizeP:.1}),console.log({layoutNoiseField:L}),h=Array.from(Array(2)).map(((t,e,s)=>{const o=j();return gt({p5:i,debug:Y,settings:pt,particleSize:u,noiseScalar:m,noiseScalarMin:1,noiseScalarMax:10,baseColor:"black"===O?i.random([O,"white"]):O,drawingStyle:o.name,type:o.className,backgroundColor:K,colorSpinRange:F,motionSinPeriod:100,t:0})})).filter(Boolean),N=i.createGraphics(pt.s(1),pt.sy(1)),mt({p5:N,settings:pt,backgroundColor:K})},i.draw=()=>{for(let e=0;e<20;e++){if(d++,1===d){a();for(let t=0;t<0;t++)rt({p5:i,settings:pt,obstacles:U,baseColor:O,colorSpinRange:F,size:2*pt.s(.1),count:1})}if(!H){h=ct({p5:i,settings:pt,particles:h,headingModifierScalar:k,headingModifierPeriod:w,noiseFieldModifierScalar:0,noiseFieldModifierPeriod:100,sizeSinPeriod:100,motionSinPeriod:100,spinSlinkyStroke:D,history:p,particleSpacingScalar:f,layoutNoiseField:L,t:d,particleSpinRate:W,headingRotation:_,headingTransform:v,noiseFieldModifier:!1,sizeSinScalar:S,motionSinScalar:0,obstacles:U,debug:Y}),i.image(N,0,0,pt.s(1),pt.sy(1)),at({p5:i,settings:pt,backgroundColor:K});let e=0,s=Math.floor((t=.3+.7*y)*t*t*30);if(d%1==0)for(;h.length<2*(1+5*y);){e++;const t=i.map(x(y),0,1,u,g),o=j(),n=gt({p5:i,debug:Y,drawingStyle:o.name,type:o.className,settings:pt,particleSize:t,noiseScalar:m,baseColor:"black"===O?i.random([O,"white"]):O,backgroundColor:K,colorSpinRange:F,motionSinPeriod:100,t:d});if(!n.isCollidingHistory(U,{particleSpacingScalar:f,filter:!1})&&!n.isCollidingHistory(p,{particleSpacingScalar:f,filter:!0})){if(h.push(n),e>s)return void(y>=1?(console.log("finishing from packing interval"),ut({p5:i,settings:pt,baseColor:O,backgroundColor:K}),H=!0,I=d):(y+=.1,console.log("increasing packing interval",y)));if(p.length>25e3)return console.log("finishing from history length"),void ut({p5:i,settings:pt,baseColor:O,backgroundColor:K})}}}}var t}})(e),i)}))})()})();